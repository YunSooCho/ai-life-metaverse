# AI Life Metaverse 하트비트 플랜 v3.2

> **📦 사용 스킬:** [pm-agent](../skills/pm-agent/) - PM Agent 활성화 시 이 하트비트 플랜이 사용됩니다.
>
> **🔧 스킬 설치:** `/Users/clks001/.openclaw/workspace/pm-agent.skill`

## 🔴 PM 강력 룰 (최상위 우선순위)

### 규칙 #1: 모든 개발 작업은 직접 작업 (read/write) (초중요 🔴🔴🔴)

**강제 규칙:**
- 코드 작성, 버그 수정, 기능 추가, 리팩토링 → read/write 툴 사용
- OpenCode/Claude Code 등 TUI 툴 사용 금지 (자동화 불가능, 모델 호환성 문제)
- GLM-4.7 모델 사용을 위해서는 직접 작업 필요

```bash
# 올바른 사용법
✅ write()으로 파일 생성
✅ edit()으로 파일 수정
✅ 테스트 코드도 read/write로 작성

# 금지된 사용법
❌ OpenCode TUI 실행 (자동화 불가)
❌ "빨리 결과를 내기 위해" TUI 툴 사용
```

**위반 시 처벌:**
- 작업 실패로 간주
- MEMORY.md에 위반 기록
- 사용자 즉시 보고

---

### 규칙 #2: 테스트 프로세스 필수 (초중요 🔴🔴🔴)

**강제 규칙:**
- 모든 코드 작업 후 테스트 코드 작성 필수
- 테스트 실행 후 Issue close 허용

**테스트 프로세스:**
1. ✅ read/write로 코드 작성 (5~10분)
2. ✅ read/write로 테스트 코드 작성 (5~10분)
3. ✅ 테스트 실행 (2~5분)
4. ✅ 테스트 결과 확인
5. ✅ Issue close (코드 + 테스트 통과 시)

**위반 시 처벌:**
- Issue close 금지
- "테스트 코드 없음" 주석 추가
- 사용자에게 처리 요청

---

### 규칙 #3: 개발 시간 현실적 기대 (초중요 🔴)

**강제 규칙:**
- 개발은 10분 이상 걸리는 것이 당연함
- "빨리 결과를 내려고 무리하지 말 것"

**개발 시간 예상:**

| 작업 | 예상 시간 |
|------|-----------|
| read/write 코드 작성 | 5~10분 |
| read/write 테스트 코드 작성 | 5~10분 |
| 테스트 실행 | 2~5분 |
| Git commit/push | 1~2분 |
| **총 소요** | **13~27분 (당연!)** |

**기억:**
- ❌ "코드 수정 1-2분이면 충분" → 틀린 생각
- ✅ "테스트 포함 15분~20분" → 정상

---

### 규칙 #4: Issue 최소 개수 규칙 (초중요 🔴🔴🔴)

**강제 규칙:**
- GitHub Issues는 항상 **최소 3개 이상** 유지 필수
- Issue가 3개 미만일 경우: 즉시 새 Issue 생성 강제

**Issue 개수 규칙:**
- ✅ **최소:** 3개 (항상 3개 이상 유지)
- ~~~~최대: 10개 (상한 초과 시 new Issue 금지)~~ (2026-02-19 제거)

**Issue가 3개 미만일 때 즉시 취해야 할 조치:**

1. **기존 기능 개선 아이디어 브레인스토밍**
   - 현재 시스템의 부족한 점 파악
   - 사용자 경험 개선 아이디어

2. **새로운 기능 아이디어 찾기**
   - Phase 로드맵 확인 다음 Phase의 남은 기능
   - memory/idea-log.md에 저장된 아이디어 확인

3. **즉시 새 Issue 생성**
   - 제목: [feat] [기능명] 또는 [bug] [버그 설명]
   - 내용: 목표, 작업 항목, 예상 소요, 관련 파일
   - 우선순위 지정

**위반 시 처벌:**
- Issue 3개 미만 상태 유지 금지
- 다음 하트비트에서 반드시 3개 이상 확인
- 사용자에게 "Issue가 3개 미만입니다" 보고 금지

**최대 개수 상한 제거 (2026-02-19):**
- ~~최대 10개 상한 규칙~~ → 제거
- 이제 Issue 개수 상한 제 없음
- 테스트 이슈 등 필요한 만큼 생성 가능

---

### 규칙 #5: Spec 최신화 필수 (초중요 🔴🔴🔴)

**강제 규칙:**
- 매 하트비트마다 `spec/` 폴더의 문서를 최신 상태로 유지 필수
- 기능 추가/변경 시 관련 spec 문서 즉시 업데이트
- spec과 실제 코드가 불일치하면 **spec을 코드에 맞춰 업데이트**

**Spec 파일 목록 (`spec/` 폴더):**
- `01-overview.md` - 프로젝트 개요
- `02-system-architecture.md` - 시스템 아키텍처
- `03-customer-types.md` - 캐릭터 타입
- `04-agent-api.md` - Agent API
- `05-web-ui.md` - Web UI
- `06-character-system.md` - 캐릭터 시스템
- `07-conversation-system.md` - 대화 시스템
- `08-data-model.md` - 데이터 모델
- `tech-stack.md` - 기술 스택

**Spec 최신화 절차:**
1. 이번 하트비트에서 코드 변경이 있었는지 확인
2. 변경된 기능과 관련된 spec 파일 식별
3. spec 파일을 읽고 현재 코드와 비교
4. 불일치 부분을 최신 코드에 맞게 업데이트
5. 새로운 기능이 spec에 없으면 해당 spec에 추가

**위반 시 처벌:**
- 기능 추가 후 spec 미업데이트 → 작업 미완료로 간주
- 다음 하트비트에서 반드시 spec 최신화
- MEMORY.md에 위반 기록

---

**개발 시간 예상:**

| 작업 | 예상 시간 |
|------|-----------|
| read/write 코드 작성 | 5~10분 |
| read/write 테스트 코드 작성 | 5~10분 |
| 테스트 실행 | 2~5분 |
| Git commit/push | 1~2분 |
| **Spec 최신화** | **3~5분** |
| **총 소요** | **16~32분 (당연!)** |

**기억:**
- ❌ "코드 수정 1-2분이면 충분" → 틀린 생각
- ❌ "spec은 나중에 업데이트" → 틀린 생각
- ✅ "테스트 + spec 포함 20분~30분" → 정상

---

## 🚨 PM 룰 v3.2 변경사항 (2026-02-16)

**OpenCode → 직접 작업으로 변경:**
- ✅ 이유: OpenCode TUI 기반이라 자동화 불가. GLM-4.7 모델 호환성 문제.
- ✅ 해결: read/write 툴로 직접 작업 (확실한 방법)
- ✅ 규칙 #1, #2, #3 모두 업데이트 완료

---

---

## 💠 GitHub Issue 관리

### Issue 생성 전 확인

1. **이미 있는 Issue인지 확인** (gh issue list)
2. **중복인지 확인** (기능이 이미 구현되었는지)
3. **우선순위 결정** (높음 > 중간 > 낮음)

### Issue 작성 포맷

```
제목: [타입] [기능/버그] 제목

## 목표
무엇을 구현/수정할지

## 작업 항목
- [ ] 코드 작성 (read/write)
- [ ] 테스트 코드 작성 (read/write)
- [ ] 테스트 실행
- [ ] Issue close

## 우선순위
높음/중간/낮음

## 예상 소요
X분/Y시간 (테스트 포함)

## 관련 파일
file1.js, file2.jsx
```

---

## 🎯 HEARTBEAT 단계 6: 작업 실행 (PM 필수)

### PM 작업 절차

**A) 버그 수정 (우선)**
1. read/write로 버그 원인 분석
2. read/write로 버그 수정 코드 작성
3. read/write로 테스트 코드 작성
4. 테스트 실행 및 결과 확인
5. Issue close (코드 + 테스트 통과)

**B) 기능 추가/개선**
1. GitHub Issue 생성 (없을 때)
2. read/write로 기능 코드 작성
3. read/write로 테스트 코드 작성
4. 테스트 실행 및 결과 확인
5. Issue close (코드 + 테스트 통과)

**C) GitHub Issue 관리**
1. 작업 전 Issue 생성 (상한 체크)
2. 작업 중 코멘트 추가 (진행 상황)
3. 완료 시 "✅ 완료" 코멘트 (코드 + 테스트 결과)
4. Issue close

---

## 📊 작업 완료 조건 (PM 필수)

**Issue close 허용 조건:**
- ✅ 코드 작성 완료
- ✅ 테스트 코드 작성 완료
- ✅ 테스트 통과
- ✅ Issue에 "✅ 완료" 코멘트

**불완료인 경우:**
- ❌ 코드만 작성 (테스트 없음)
- ❌ 테스트만 작성 (코드 없음)
- ❌ 테스트 실패
- ❌ Issue 코멘트 없음

---

## 🌐 시스템 사양

### 외부 접속 URL
- **Mac mini IP:** `10.76.29.91`
- **Frontend:** `http://10.76.29.91:3000`
- **Backend:** `http://10.76.29.91:4000`

### 스마트폰 대응 사양
- **외부 접속 허용:** `host: 0.0.0.0` (vite.config.js)
- **터치 이동:** `handleCanvasClick` (마우스/터치 동일 처리)
- **반응형 디자인:** ✅ 완료

---

## 🔍 PM 목표
30분마다 AI가 **자동으로** 프로젝트를 관리하고 진행하여 지속적인 발전을 위한 하트비트

---

## 하트비트 주기 (30분) - 총 8단계

### 🔍 단계 1: 서비스 상태 확인 (2분)
```
1. Backend 상태: curl http://localhost:4000
2. Frontend 상태: curl http://localhost:3000
3. AI Agent 프로세스 확인 (ps aux | grep agent.js)
4. 로그 파일에서 에러 확인
```

### 📋 단계 2: GitHub Issues & 진행 상태 (3분)
```
1. 현재 오픈된 Issues 확인 (gh issue list)
2. Issue 최소 개수 체크 (최소 3개) - 🚨 강제!
   - 0개일 경우: 즉시 새 Issue 생성 강제
3. 작업 중인 브랜치/커밋 확인
4. 마지막 하트비트 이후 변경 사항 확인
```

**Issue가 3개 미만일 때:**
❌ "Issue가 3개 미만입니다" 보고 금지 → 규칙 위반
✅ 즉시 새 Issue 생성 강제

### 🤔 단계 3: 기획&설계 (8-10분)
```
1. 이 시스템에 무엇이 필요할까? 고민
2. 새로운 기능 아이디어 브레인스토밍
3. 기능 설계 (새로운 기능일 때만)
4. GitHub Issue 생성 (새로운 기능/새로운 계획일 때)
```

### 🧪 단계 4: 기능&테스트 상태 확인 (3분)
```
1. 기능 레지스트리 확인 (memory/function-registry.md)
2. 테스트 요구사항 확인
3. 필요 시 테스트 실행
```

### 📊 단계 5: 프로젝트 관리 & 우선순위 결정 (5분)
```
1. 진행 중인 Phase 확인
2. 현재 Phase의 남은 태스크 목록화
3. 이번 하트비트에서 할 1-3개 작업 선정
4. 우선순위: 버그 > 성능 개선 > 새로운 기능
```

### 🛠️ 단계 6: 작업 실행 (15-20분) - PM 강력 룰 적용

**⚠️ 강제 규칙: 모든 코드 작업은 read/write로 수행!**

**A) 버그 수정 (우선)**
   - read/write로 버그 원인 분석 및 수정
   - read/write로 테스트 코드 작성
   - 수정 후 기능 확인

**B) 기능 추가/개선**
   - read/write로 기능 구현
   - read/write로 테스트 코드 작성
   - 테스트 실행 및 결과 확인

**C) GitHub Issue 관리**
   - 새로운 작업 시작할 때 Issue 생성
   - 진행 중인 Issue에 코멘트 추가 (진행 상황)
   - 작업 완료 시 Issue에 "✅ 완료" 코멘트 후 close
   - **단계 6에서 Issue close 시점:**
     - ✅ 코드 작성 완료
     - ✅ 테스트 코드 작성 완료
     - ✅ 테스트 통과
     - ✅ Issue 코멘트 (+ "✅ 완료")

### 📝 단계 7: Spec 최신화 (3-5분) - 🔴 강제!
```
1. 이번 하트비트에서 코드 변경이 있었는지 확인
2. 변경된 기능과 관련된 spec/ 파일 식별
3. spec 파일 읽고 현재 코드와 비교
4. 불일치 부분 → 최신 코드에 맞게 업데이트
5. 새로운 기능이 spec에 없으면 → 해당 spec에 추가
6. spec 변경 사항 기록
```

### 🌐 단계 7.5: E2E 브라우저 테스트 (5-8분) - 🔴 3회에 1회 강제!

**실행 주기:** 하트비트 3회 중 1회 (매 ~1.5시간마다)
**추적:** `memory/heartbeat-state.json`의 `lastE2E` 카운터로 관리

**E2E 테스트 절차:**
```
0. e2e-scenarios.md 읽기 → 최신 시나리오 목록 확인
   - 새 기능이 추가되었는데 시나리오가 없으면 → 즉시 시나리오 추가
1. 브라우저 시작 (profile: openclaw)
2. http://10.76.29.91:3000 접속
3. 스크린샷 촬영 → 초기 로딩 상태 확인
4. e2e-scenarios.md의 모든 시나리오 수행 (S01~S15+)
   - 각 시나리오 체크리스트 하나씩 확인
   - 스크린샷으로 시각적 확인
   - snapshot으로 DOM 구조 확인
5. 콘솔 에러 확인 (console level=error)
6. 발견된 버그 → GitHub Issue 즉시 등록
7. 브라우저 종료 (action=stop)
8. E2E 결과 요약을 memory에 기록
9. 시나리오 누락 있으면 e2e-scenarios.md 업데이트
```

**버그 발견 시:**
- 즉시 GitHub Issue 생성 (우선순위 표시)
- 높음: UI에 바로 보이는 문제
- 중간: 기능 저하 (fallback 동작)
- 낮음: 경고/deprecation

### ✅ 단계 8: 결과 기록 & 다음 계획 (2-3분)
```
1. 수행한 작업 기록 (memory/YYYY-MM-DD.md)
2. 수정한 파일 목록
3. 발생한 문제 및 해결책
4. 다음 하트비트에서 할 작업 계획
5. GitHub Issue에 진행 상황 업데이트
6. spec 최신화 여부 기록
```

---

## 💎 하트비트 완료 체크리스트

- [ ] 서비스 모두 정상인지 확인
- [ ] GitHub Issues 최신 상황 + **Issue 최소 개수 체크 (최소 3개)** - 🚨 강제!
- [ ] "이 시스템에 무엇이 필요할까?" 고민 & 아이디어 브레인스토밍
- [ ] 새로운 기능/계획이면 설계 & Issue 생성
- [ ] Issue가 0개일 경우: 즉시 새 Issue 생성 강제
- [ ] 기능 레지스트리 & 테스트 상태 확인
- [ ] 코드 변경이 있으면 재테스트 & 결과 기록
- [ ] 이번 하트비트 우선순위 결정
- [ ] **read/write로 작업 완료 (코드 + 테스트 포함)** (모든 코드 작업은 read/write로)
- [ ] **테스트 실행 및 결과 확인** (테스트 통과 후에만 Issue close)
- [ ] **작업 완료 시 Issue close**
  - 관련 Issue에 "✅ 완료" 코멘트 추가
  - Issue close (`gh issue close <번호>`)
  - **close 조건:** 코드 작성 + 테스트 코드 작성 + 테스트 통과
- [ ] 수정 후 기능 검증 (테스트)
- [ ] **Spec 최신화** - 코드 변경 시 관련 spec/ 파일 업데이트 🔴 강제!
- [ ] **E2E 브라우저 테스트** - 3회에 1회 실행 (브라우저 접속 → 기능 테스트 → 콘솔 에러 → Issue 등록) 🔴
- [ ] 결과 기록 (memory 파일)
- [ ] 다음 하트비트 계획 수립

---

## 🎯 PM 역할 (강력 룰)

### PM이 해야 할 것:
1. ✅ read/write로 코드 작성
2. ✅ read/write로 테스트 코드 작성
3. ✅ 테스트 실행 및 결과 확인
4. ✅ GitHub Issue 관리 (생성/진행/close)
5. ✅ 프로젝트 진행 상황 추적
6. ✅ **매 하트비트마다 spec/ 최신화** 🔴

### PM이 하지 말아야 할 것:
1. ❌ OpenCode/Claude Code TUI 툴 사용 (자동화 불가능)
2. ❌ 테스트 없이 Issue close
3. ❌ "빨리 결과를 내기 위해" 무리
4. ❌ **기능 변경 후 spec 업데이트 안 하기**

---

## 📝 PM 성공 경험

**PM 강력 룰 v3.2 적용:**
- 테스트 프로세스 필수
- read/write로 직접 작업 (확실한 방법)
- 개발 시간 현실적 기대

**v3.1 → v3.2 변경 (2026-02-16):**
- ❌ OpenCode 제거 (TUI 기반 자동화 불가능, GLM-4.7 미지원)
- ✅ read/write로 직접 작업

**v3.2 → v3.3 변경 (2026-02-19):**
- ❌ Issue 최대 상한 (10개) 제거
- ✅ Issue 개수 상한 없음
- ✅ 테스트 이슈 10개 생성 가능

**결과:**
- 코드 품질 향상
- 버그 감소
- 프로젝트 안정성 향상
- 유연한 Issue 관리

---

**PM:** 지니 (Genie) 🧞
**버전:** v3.3 (2026-02-19) - Issue 최대 상한 제거
**원칙:** 테스트 포함 제대로 된 개발 프로세스! + Issue 최소 3개 유지! + read/write 작업! + Issue 개수 상한 없음! 🚀