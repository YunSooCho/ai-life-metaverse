# Character System (거래 시스템 포함)

## 캐릭터 구조

### 기본 속성

```javascript
{
  id: 'player | ai-id',
  name: '플레이어 이름',
  x: 125,        // X 좌표 (0 ~ 1000)
  y: 125,        // Y 좌표 (0 ~ 700)
  color: '#4CAF50',
  emoji: '👤',
  isAi: false    // AI 캐릭터 여부
}
```

### 커스터마이징 속성

```javascript
{
  hairStyle: 'short | medium | long',
  clothingColor: 'blue | red | green | yellow | purple',
  accessory: 'none | glasses | hat | flowers'
}
```

## 픽셀아트 캐릭터 (✅ 구현 완료)

### 사양

- **기본 사이즈:** 32x32 픽셀
- **렌더링 사이즈:** 40x40px (확대)
- **색상 팔레트:** 8비트 레트로 스타일
- **애니메이션 프레임:** 2~4 프레임 / 초

### 감정 애니메이션 시스템 (✅ 구현 완료)

| 감정 | 프레임 | 속도 | 루프 | 설명 | 상태 |
|------|----------|------|------|------|------|
| idle | 1 | 500ms | ✅ | 정지 상태 | ✅ 구현 완료 |
| happy | 2 | 300ms | ✅ | 행복 | ✅ 구현 완료 |
| sad | 2 | 400ms | ✅ | 슬픔 | ✅ 구현 완료 |
| angry | 2 | 200ms | ✅ | 화남 | ✅ 구현 완료 |
| surprised | 2 | 150ms | ✅ | 놀람 | ✅ 구현 완료 |

## 거래 시스템 (Phase 15) - ✅ 완료 (2026-02-21)

### 개요
거래 시스템은 상점, 플레이어 간 거래, 경매, 코인 시스템으로 구성됩니다.

### 완료 상태 (2026-02-21)
- **Backend:** ✅ 완전 구현 (ShopManager, TradeManager, AuctionManager, CoinManager)
- **Frontend:** ✅ 완전 구현 (Shop, Trade, Auction, Coin UI 포함)
- **테스트:** ✅ Backend 101/101 통과

### 상점 시스템 (Shop)

**Backend API:**
- `GET /api/shop/list` - 모든 상점 목록 조회
- `GET /api/shop/:shopId` - 특정 상점 조회
- `POST /api/shop/buy` - 아이템 구매
- `POST /api/shop/sell` - 아이템 판매

**Frontend UI (✅ 완료):**
- `Shop.jsx` - 상점 UI 컴포넌트
- `TradeWindow.jsx` - 거래 창 UI
- `AuctionWindow.jsx` - 경매 창 UI
- `CoinDisplay.jsx` - 코인 표시 UI

**기능:**
- 상점 목록 표시 (다중 상점 탭)
- 아이템 구매/판매 버튼
- 코인 잔액 표시
- 인벤토리 판매 가능 아이템 표시
- 재고 관리 UI
- 플레이어 간 거래 (요청/수락/거절/취소/완료)
- 경매 시스템 (등록/입찰/낙찰/취소/수수료 5%)
- 코인 시스템 (획득/소비/전송/기록)

### GitHub Issue
- **#130:** [feat] Phase 13: 제작 시스템 UI 구현 ✅ 완료 (2026-02-21)
- **#100:** [feat] Phase 15: 거래 시스템 종합 UI 구현 ✅ 완료 (2026-02-21)

---

## 파티 시스템 (Phase 14) - ✅ 완료 (2026-02-23)

### 개요
파티 시스템은 최대 5인의 플레이어 파티를 구성하여 퀘스트, 사냥, 보스전을 협동으로 수행할 수 있는 시스템입니다.

### 완료 상태 (2026-02-23)
- **Backend:** ✅ 완전 구현 (PartyManager, PartyChat, ExpShare, RewardDistribution, PartyQuests)
- **Frontend:** ⏳ 필요 (이후 Phase)
- **테스트:** ✅ 91개 테스트 작성 완료

### 파티 관리 (PartyManager)

**기능:**
- 파티 생성 (최대 5인)
- 파티 초대 (플레이어 초대/수락/거절)
- 파티 탈퇴/추방
- 파티장 위임
- 파티 해체
- 파티 정보 조회

**파티 데이터 구조:**
```javascript
{
  partyId: 'party-uuid',
  leaderId: 'player-id',
  maxMembers: 5,
  members: ['player-id-1', 'player-id-2', ...],
  status: 'active' | 'disbanded'
}
```

### 파티 채팅 (PartyChat)

**기능:**
- 파티 전용 채팅 채널
- 파티 멤버만 볼 수 있는 메시지
- 파티 채팅 히스토리 (최대 100개)
- 시스템 메시지 지원 (초대, 탈퇴, 해체 등)

**채팅 메시지 전송:**
```javascript
partyChat.sendMessage(partyId, playerId, message);

{
  messageId: 'msg-uuid',
  partyId: 'party-uuid',
  playerId: 'player-id',
  playerName: '플레이어 이름',
  message: '메시지 내용',
  timestamp: 1645623456789,
  isSystem: false
}
```

### 경험치 공유 (ExpShare)

**기능:**
- 파티원 간 경험치 공유
- 레벨 차이에 따른 보정 (+10% ~ -100%)
- 파티 보너스 (파티원 1인당 +10%, 최대 +50%)
- 효율성 계산 (개인 vs 파티)

**경험치 보정:**
- 레벨 차이 ±3: ±0% (기본)
- 레벨 차이 ±4~6: ±10%
- 레벨 차이 ±7~9: ±20%
- 레벨 차이 ±10+: -50%~ -100%

**파티 보너스:**
- 2인 파티: +10%
- 3인 파티: +20%
- 4인 파티: +30%
- 5인 파티: +50%

### 보상 분배 (RewardDistribution)

**기능:**
- 퀘스트 보상 분배 (균등/랜덤/기여도 기반)
- 파티 내 랜덤 퀘스트 생성
- 파티 전용 보상
- 파티 보너스 아이템

**분배 방법:**
1. **균등 분배:** 모든 파티원에게 동일하게 분배
2. **랜덤 분배:** 랜덤으로 한 명에게 분배
3. **기여도 기반:** 기여도에 따라 비례 분배

### 파티 퀘스트 (PartyQuests)

**기능:**
- 파티 전용 퀘스트 (보스/협동)
- 협동 기반 퀘스트
- 파티 보스전
- 퀘스트 진행 상황
- 완료/포기/만료 처리

**퀘스트 유형:**
- **보스 퀘스트:** 보스 몬스터 처치 (일정 기여도 요구)
- **협동 퀘스트:** 파티원들이 함께 목표 달성
- **파티 레이드:** 대규모 파티 던전 (추후 구현)

### GitHub Issue
- **#146:** [feat] Phase 14: 파티 시스템 ✅ 완료 (2026-02-23)

---

## 기존 캐릭터 시스템

### 픽셀아트 캐릭터 (✅ 구현 완료)

### 감정 애니메이션 시스템 (✅ 구현 완료)

### 캐릭터 커스터마이징 (✅ 구현 완료)

### 장비 시스템 (✅ 구현 완료)

### 스킬 시스템 (✅ 구현 완료)

---

## AI 캐릭터 시스템 고도화 (Phase 13) - ✅ 완료 (2026-02-23)

### 개요
AI 캐릭터 시스템 고도화는 AI 캐릭터가 올바른 위치에 있는지 검증하는 테스트 시스템을 포함합니다.

### 완료 상태 (2026-02-23)
- **Backend:** ✅ AI 캐릭터 위치 검증 완료
- **Frontend:** ✅ GameCanvas 렌더링 검증 완료
- **테스트:** ✅ 6개 테스트 작성 완료

### AI 캐릭터 위치 시스템

**기능:**
- 그리드 기반 위치 시스템 (셀 크기: 50x50px)
- 셀 중심 좌표 계산 (gridX * 50 + 25, gridY * 50 + 25)
- 맵 경계 검증 (0 ~ 1000 x 0 ~ 700)
- AI 캐릭터 중복 거리 검증

**좌표 계산:**
- 올바른 셀 중심: (gridX * CELL_SIZE + CELL_SIZE/2, gridY * CELL_SIZE + CELL_SIZE/2)
- 예: Grid (10, 7) → (525, 375)
- 버그 가능성: 셀 시작점 (500, 350)에 위치할 수 있음

**테스트 케이스 (6개):**
1. AI 캐릭터가 올바른 그리드 위치에 있는지 검증
2. AI 캐릭터가 셀 중심에 위치해야 함 (버그 감지)
3. AI 캐릭터가 셀 안에 있는지 확인
4. AI 캐릭터가 셀 중심과 정확히 일치하는지 확인
5. 맵 경계 밖에 있지 않아야 함
6. AI 캐릭터끼리 겹쳐있지 않아야 함

### GitHub Issue
- **#121:** [test] AI 캐릭터 위치 테스트 ✅ 완료 (2026-02-23)

---

**PM 로그 - 2026-02-23 22:00**
- Phase 13 AI 캐릭터 시스템 고도화 완료
- 6개 테스트 작성 완료
- 버그 감지 가능성 추가 (셀 중심 vs 셀 시작점)