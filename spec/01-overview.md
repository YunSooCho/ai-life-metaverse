# Overview - AI Life Metaverse

## 프로젝트 개요

AI Life Metaverse는 사용자가 AI 캐릭터와 상호작용하는 웹 기반 메타버스 게임입니다.

### 핵심 기능

1. **실시간 채팅**: Socket.io 기반 멀티유저 채팅
2. **AI 캐릭터**: GLM-4.7 기반 AI 대화 시스템
3. **캐릭터 커스터마이징**: 머리 스타일, 옷 색상, 액세서리
4. **호감도 시스템**: AI와의 상호작용에 따라 호감도 변화
5. **캐릭터 레벨 & 경험치 시스템**: 레벨(1~100), 경험치, 스테이터스 (HP, 친화력, 카리스마, 지능)
6. **방 이동**: 다른 방(공간)으로 이동 가능
7. **건물 시스템**: 건물 입장/퇴장 및 이벤트 기록
8. **퀘스트 시스템**: 퀘스트 수락 및 보상
9. **인벤토리**: 아이템 수집 및 사용
10. **보상 시스템**: 보상 수령 및 기록
11. **날씨 시스템 v2.0**: 강화된 비/눈 애니메이션 + 부드러운 날씨 전환
   - 비: 물방울 tear-drop 형태, 바람 각도, 낙하 속도 변화
   - 눈: 눈송이 별형 (6개 꼭지), 좌우 흔들림 (swaying), 회전
   - WeatherState: 3초 페이드 인/아웃으로 부드러운 전환
12. **사운드 시스템**: BGM + 효과음 + 날씨 사운드
   - BGM: 메인 테마, day/night 테마 (fade in/out)
   - 효과음: 버튼 클릭, 이동, 알림, 퀘스트 완료, 아이템 획득
   - 날씨 사운드: 비, 눈 ambient
   - 볼륨 조절: 마스터, BGM, SFX, 날씨
   - 음소거 토GGLE
13. **다국어 지원**: 한국어/영어/일본어
14. **데이터 영속성 시스템** ✅ (Redis/DB 기반): 
   - 캐릭터 데이터 영속화
   - 인벤토리 데이터 영속화
   - 호감도 데이터 영속화
   - 퀘스트 진행 상태 영속화
   - 채팅 히스토리 영속화
   - 방 데이터 영속화
   - 통합 저장/로드 API
   - Graceful degradation (Redis 연결 실패 시 메모리 모드)

### 기술 스택

- **Frontend**: React + Vite
- **Backend**: Node.js + Express + Socket.io
- **AI**: Cerebras zai-glm-4.7
- **Styling**: CSS (Pixel Theme)
- **State Management**: React Hooks

### 파일 구조

```
ai-life-metaverse/
├── backend/
│   ├── server.js          # 메인 서버
│   ├── ai-agent/          # AI Agent 로직
│   ├── data/              # 데이터 파일
│   └── routes/            # API 라우트
├── frontend/
│   ├── src/
│   │   ├── components/    # React 컴포넌트
│   │   ├── hooks/         # Custom Hooks
│   │   ├── i18n/          # 다국어
│   │   ├── styles/        # 스타일
│   │   └── utils/         # 유틸리티
└── spec/                  # 스펙 문서
```

### 개발 진행 상황

**Phase 3: 픽셀아트 레이아웃** ✅ 완료 (2026-02-18)
- 캐릭터 픽셀아트 에셋
- 배경 픽셀아트 타일 시스템
- 애니메이션 시스템 (idle, walk, run, jump, sit, emotions)
- FX 스프라이트 시스템 (캐릭터 리액션 효과)

**Phase 6: AI 캐릭터 관계 시스템** ✅ 완료 (2026-02-19)
- 캐릭터 간 친밀도 추적 (0~100)
- 관계 레벨 시스템 (낯선 사람 → 지인 → 친구 → 좋은 친구 → 베프)
- 관계 레벨별 대화 스타일
- 리액션 시스템 (시간대별, 선물, 퀘스트, 특별 이벤트)

**Phase 7: 이벤트 시스템** ✅ 완료 (2026-02-19 12:30)
- 시즌 이벤트 (봄/여름/가을/겨울)
- 특별 이벤트 (할로윈, 크리스마스, 신년)
- 일일/주간 퀘스트
- 이벤트 리워드

**Phase 8: 멀티플레이어 확장** ✅ 완료
- 방 capacity 제한
- 프라이빗 메시지
- 이모지 지원
- 활성 방 목록 API

**Phase 9: 친구 시스템** ✅ 완료 (2026-02-19)
- FriendManager - 친구 추가/삭제/목록/검색
- FriendRequest - 요청 전송/수락/거절/취소
- OnlineStatus - 온라인 상태 관리
- Redis 기반 데이터 저장
- 테스트 82/82 통과 (100%)

**Phase 10: 거래 시스템** ✅ 완료 (2026-02-19)
- TradeManager - 플레이어 간 아이템 거래 (요청/수락/거절/취소/완료)
- ShopManager - NPC 상점 (구매/판매/재고 관리/가격 설정)
- AuctionManager - 경매장 (등록/입찰/낙찰/취소/수수료 5%)
- CoinManager - 코인 시스템 (획득/소비/전송/랭킹/기록)
- Redis 기반 영속화 + 메모리 fallback
- 테스트 101/101 통과 (100%)
- ES Module 형식

**Phase 11: 월드맵 시스템 정교화** ✅ 완료 (2026-02-19 19:30)
- 맵 상호작용 시스템 (클릭, 호버)
- 맵 전환 애니메이션
- 맵별 고유 이벤트 트리거
- 맵 내 비밀 장소/숨겨진 아이템
- 맵 탐험 진행률 시스템
- 맵 날씨 시스템 연동
- 맵 기반 퀘스트 생성
- 통합 맵 시스템 V2
- 테스트 코드 완성 (11개 파일)

### TODO

- [ ] 채팅 말풍운 표시 버그 수정 (Issue #126, 2026-02-20 발견)
- [ ] main_theme 사운드 파일 배치 (Issue #41, 2026-02-20 콘솜 에러 확인)
- [ ] 사운드 파일 준비 (audio/ 폴더에 BGM, SFX, 날씨 사운드 배치)
- [ ] 사운드 초기화 oneshot (사용자 interaction 이후)
- [ ] E2E 브라우저 테스트 자동화 (Issue #59)
- [ ] 남은 시나리오 테스트 (S04, S06, S08, S10~S14)

### 완료된 작업

- ✅ Phase 13: 제작 시스템 - Issue #115 (2026-02-19 23:30)
  - RecipeManager: 레시피 관리 (등록/삭제/조회/레벨 필터)
  - CraftingManager: 제작 로직 (재료 확인/소비/결과 생성)
  - CraftingTable: 제작대 시스템 (초급/중급/고급, 보너스 효과)
  - 제작 경험치/레벨 시스템 (1~100)
  - 제작 실패 확률 및 난이도
  - 테스트 29/29 통과 ✅
  - Socket.io 이벤트 통합 (getRecipes, getCraftingLevel, craft, getCraftingHistory)

- ✅ E2E 브라우저 테스트 (2026-02-20 00:00)
  - 완료된 시나리오: S01, S02(부분), S03(부분), S07, S09
  - 발견된 버그: #126 채팅 말풍운 표시 안됨, #41 main_theme 사운드 로드 실패

- ✅ Phase 12: 캐릭터 진화 시스템 - Issue #113 (2026-02-19)
  - EvolutionManager: 진화 시스템 (조건/경험치/레벨/형태)
  - CharacterFormManager: 캐릭터 형태 관리
  - 진화 이펙트 및 사운드
  - 테스트 완료 ✅

- ✅ Phase 11: 월드맵 시스템 정교화 (2026-02-19 19:30)
  - 맵 상호작용 시스템
  - 맵 전환 애니메이션
  - 맵별 고유 이벤트 트리거
  - 맵 내 비밀 장소/숨겨진 아이템
  - 테스트 코드 완성 (11개 파일) ✅

- ✅ Phase 10: 거래 시스템 (2026-02-19)
  - TradeManager: 플레이어 간 아이템 거래
  - ShopManager: NPC 상점 (구매/판매/재고 관리)
  - AuctionManager: 경매장 (등록/입찰/낙찰/취소)
  - CoinManager: 코인 시스템
  - 테스트 101/101 통과 (100%) ✅

- ✅ Phase 9: 친구 시스템 (2026-02-19 23:30)
  - FriendManager: 친구 추가/삭제/목록/검색
  - FriendRequest: 요청 전송/수락/거절/취소
  - OnlineStatus: 온라인 상태 관리
  - 테스트 82/82 통과 (100%) ✅
  - vitest.config.js 수정 (friend-system 경로 추가)

- ✅ Phase 6: AI 캐릭터 관계 시스템 - Issue #95 (2026-02-19)
  - RelationshipManager: 캐릭터 간 관계 관리 (친밀도, 레벨, 상호작용)
  - ReactionSystem: 리액션 시스템 (시간대별, 선물, 퀘스트, 특별 이벤트)
  - 관계 기반 대화 스타일 통합
  - 테스트 코드 59개 전체 통과 ✅
  - Socket.io 이벤트 통합 (giftGive, questComplete, characterReaction)
- ✅ Phase 3: 픽셀아트 스타일 완료 (2026-02-18)
  - PixelArtRenderer: 픽셀아트 렌더링
  - AnimationController: 애니메이션 채널 시스템
  - FX 스프라이트 시스템
  - AI 캐릭터 자동 이동 시스템
- ✅ 날씨 효과 강화 (비/눈 애니메이션, 페이드 전환) - Issue #41 (2026-02-18)
- ✅ 사운드 시스템 구현 (BGM, SFX, 날씨 사운드) - Issue #87 (2026-02-18)
- ✅ 날씨 효과 강화 (비/눈 애니메이션, 페이드 전환) - Issue #41 (2026-02-18)
- ✅ 사운드 시스템 구현 (BGM, SFX, 날씨 사운드) - Issue #87 (2026-02-18)